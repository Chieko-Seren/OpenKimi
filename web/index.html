<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenKimi Web UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Add Heroicons for sidebar icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="https://i.postimg.cc/6qdQbvPf/open-kimi.png" type="image/png">
</head>
<body class="flex h-screen overflow-hidden">

    <div id="app" class="flex w-full h-full">

        <!-- Sidebar -->
        <aside class="w-16 flex flex-col items-center bg-white py-4 space-y-4 border-r border-gray-200">
            <!-- Top Logo/Icon -->
            <div class="p-2 bg-black text-white rounded-lg mb-4">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 18.657A8 8 0 016.343 7.343m11.314 11.314a8 8 0 00-11.314-11.314m11.314 11.314L6.343 7.343" />
                 </svg>
            </div>
            <!-- Icons -->
            <div class="sidebar-icon active">
                <ion-icon name="chatbubbles-outline" class="text-2xl"></ion-icon>
            </div>
            <div class="sidebar-icon">
                 <ion-icon name="folder-outline" class="text-2xl"></ion-icon>
            </div>
            <div class="sidebar-icon">
                <ion-icon name="settings-outline" class="text-2xl"></ion-icon>
            </div>
            <div class="sidebar-icon">
                <ion-icon name="extension-puzzle-outline" class="text-2xl"></ion-icon>
            </div>
            
            <!-- Spacer -->
            <div class="flex-grow"></div>

            <!-- Bottom Icons -->
             <div class="sidebar-icon">
                <ion-icon name="log-in-outline" class="text-2xl"></ion-icon> <!-- Login Placeholder -->
            </div>
             <div class="sidebar-icon">
                <ion-icon name="tv-outline" class="text-2xl"></ion-icon> <!-- Some other icon -->
            </div>
             <div class="sidebar-icon">
                <ion-icon name="phone-portrait-outline" class="text-2xl"></ion-icon> <!-- Another icon -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-grow flex flex-col overflow-hidden">
            
            <!-- Initial View (Centered Logo, Input, Suggestions) -->
            <div v-if="!chatStarted" class="flex flex-col items-center justify-center flex-grow p-4">
                <!-- Kimi Logo -->
                <div class="kimi-logo-gradient mb-12 select-none">
                    KIMI
                </div>

                 <!-- Main Input Box -->
                <div class="w-full max-w-3xl bg-white rounded-lg shadow-lg p-4 flex flex-col relative">
                    <textarea 
                        v-model="userInput"
                        @keydown.enter.prevent="startOrSendMessage"
                        placeholder="尽管问..."
                        class="w-full p-2 mb-2 border-none focus:outline-none focus:ring-0 resize-none text-base"
                        rows="3"
                    ></textarea>
                    <div class="flex items-center justify-between text-sm text-gray-500">
                        <div class="flex items-center space-x-2">
                            <button class="flex items-center px-2 py-1 border rounded hover:bg-gray-100">
                                <ion-icon name="bulb-outline" class="mr-1"></ion-icon>
                                k1.5 长思考
                            </button>
                             <button class="flex items-center px-2 py-1 border rounded hover:bg-gray-100">
                                <ion-icon name="globe-outline" class="mr-1"></ion-icon>
                                联网搜索
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="p-1 rounded hover:bg-gray-100">
                                <ion-icon name="cube-outline" class="text-xl"></ion-icon>
                            </button>
                             <button @click="triggerFileUpload" class="p-1 rounded hover:bg-gray-100" :class="{'text-blue-500': uploadedFiles.length > 0}">
                                <ion-icon name="attach-outline" class="text-xl"></ion-icon>
                                <input 
                                    type="file" 
                                    ref="fileInput" 
                                    @change="handleFileUpload" 
                                    accept=".pdf,.docx,.txt,.doc" 
                                    multiple
                                    class="hidden" 
                                />
                            </button>
                            <button @click="startOrSendMessage" :disabled="isLoading || userInput.trim() === ''" class="p-1 rounded hover:bg-gray-100 disabled:opacity-50">
                                <ion-icon name="send-outline" class="text-xl"></ion-icon>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Suggestion Prompts -->
                <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 w-full max-w-3xl">
                     <!-- Replace static buttons with v-for -->
                     <button v-for="suggestion in suggestions" :key="suggestion.title" 
                             @click="useSuggestion(suggestion.title)" 
                             class="bg-white p-3 rounded-lg shadow hover:bg-gray-50 text-left text-sm text-gray-700 flex items-center space-x-2">
                        <!-- Use dynamic icon based on suggestion data -->
                        <ion-icon :name="suggestion.icon || 'chatbubble-outline'" class="text-lg"></ion-icon> 
                        <span>{{ suggestion.title }}</span>
                    </button>

                    <!-- Placeholder for loading suggestions -->
                     <div v-if="suggestionsLoading" class="col-span-1 md:col-span-3 text-center text-gray-500">
                        加载建议中...
                    </div>
                     <!-- Placeholder if suggestions fail to load -->
                     <div v-if="!suggestionsLoading && suggestions.length === 0" class="col-span-1 md:col-span-3 text-center text-gray-500">
                        无法加载建议。
                    </div>
                </div>

            </div>

            <!-- Chat View (Shown after first message) -->
            <div v-if="chatStarted" class="flex flex-col flex-grow p-4 overflow-hidden">
                <!-- Header (Optional, can be simpler here) -->
                <header class="mb-4 flex items-center justify-between border-b pb-2">
                    <h1 class="text-xl font-semibold text-gray-700">对话中</h1>
                     <div class="text-sm text-gray-500">
                        API: {{ apiStatus }} (<button @click="checkApiStatus" class="text-blue-500 hover:underline">刷新</button>)
                     </div>
                </header>

                <!-- Chat History -->
                <div class="chat-history flex-grow overflow-y-auto mb-4 pr-2 space-y-4" ref="chatHistory">
                     <div v-for="message in history" :key="message.id" :class="['flex', message.role === 'user' ? 'justify-end' : 'justify-start']">
                        <div :class="['p-3 rounded-lg max-w-xl shadow', message.role === 'user' ? 'bg-blue-500 text-white' : message.role === 'system' ? 'bg-gray-200 text-gray-800' : 'bg-white text-gray-800']">
                            <!-- Role can be omitted or styled differently in chat view -->
                             <!-- <strong class="capitalize">{{ message.role }}:</strong> -->
                            <div v-html="renderMarkdown(message.content)" class="prose prose-sm max-w-none"></div>
                        </div>
                    </div>
                    <!-- Loading Indicator -->
                    <div v-if="isLoading" class="flex justify-start">
                        <div class="p-3 rounded-lg max-w-xl bg-white text-gray-800 shadow">
                            <div class="flex items-center justify-center">
                                <svg class="animate-spin h-5 w-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span class="ml-2 text-sm text-gray-500">思考中...</span>
                            </div>
                        </div>
                    </div>
                    <!-- File uploading indicator -->
                    <div v-if="isUploading" class="flex justify-start">
                        <div class="p-3 rounded-lg max-w-xl bg-white text-gray-800 shadow">
                            <div class="flex items-center justify-center">
                                <svg class="animate-spin h-5 w-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <span class="ml-2 text-sm text-gray-500">文件上传中...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area (Similar to initial view's input box) -->
                 <div class="w-full bg-white rounded-lg shadow-lg p-4 flex flex-col relative border border-gray-200">
                    <!-- Uploaded files list -->
                    <div v-if="uploadedFiles.length > 0" class="mb-2 border-b pb-2">
                        <div class="text-xs text-gray-500 mb-1">已上传文件:</div>
                        <div class="flex flex-wrap gap-2">
                            <div v-for="file in uploadedFiles" :key="file.id" class="flex items-center bg-gray-100 rounded px-2 py-1 text-xs">
                                <ion-icon name="document-outline" class="mr-1 text-gray-500"></ion-icon>
                                <span class="truncate max-w-[150px]">{{ file.name }}</span>
                                <span class="text-xs ml-1 text-gray-400">({{ file.status }})</span>
                            </div>
                        </div>
                    </div>
                    <textarea 
                        v-model="userInput"
                        @keydown.enter.prevent="startOrSendMessage"
                        placeholder="继续提问..."
                        class="w-full p-2 mb-2 border-none focus:outline-none focus:ring-0 resize-none text-base"
                        rows="3"
                    ></textarea>
                    <div class="flex items-center justify-between text-sm text-gray-500">
                        <div class="flex items-center space-x-2">
                            <!-- Simplified buttons for chat view -->
                            <button @click="resetChat" :disabled="isLoading" class="flex items-center px-2 py-1 border rounded hover:bg-gray-100 disabled:opacity-50">
                                <ion-icon name="refresh-outline" class="mr-1"></ion-icon>
                                新对话
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button class="p-1 rounded hover:bg-gray-100">
                                <ion-icon name="cube-outline" class="text-xl"></ion-icon>
                            </button>
                             <button @click="triggerFileUpload" class="p-1 rounded hover:bg-gray-100" :class="{'text-blue-500': uploadedFiles.length > 0}">
                                <ion-icon name="attach-outline" class="text-xl"></ion-icon>
                                <input 
                                    type="file" 
                                    ref="fileInput" 
                                    @change="handleFileUpload" 
                                    accept=".pdf,.docx,.txt,.doc" 
                                    multiple
                                    class="hidden" 
                                />
                            </button>
                            <button @click="startOrSendMessage" :disabled="isLoading || userInput.trim() === ''" class="p-1 rounded hover:bg-gray-100 disabled:opacity-50">
                                <ion-icon name="send-outline" class="text-xl"></ion-icon>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
             <!-- Footer (Optional) -->
            <footer class="text-center text-xs text-gray-400 p-2 border-t mt-auto">
                © 2024 OpenKimi Clone | API URL: {{ apiUrl }}
            </footer>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html> 